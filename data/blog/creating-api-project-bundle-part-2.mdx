---
title: Preparing the machine and setting up the project (Part 2).
summary:
date: 02-14-2023
tags:
  - learning
  - PHP
  - HOW-TO-API
---

<TOCInline toc={props.toc} />

# Before we start

I am going to create a repository called `keyword-analyser`, based on the template I published before.

This is the [template repository](https://github.com/didslm/nginx-php-skeleton).

# Choosing a framework

I am going to choose [Symfony](https://symfony.com/) for our project here, I will use the API skeleton using composer.
```terminal
composer create-project symfony/skeleton:"6.2.*" app && \
cp -r app/* . && rm -r app
```

# Pushing your code

Now since we have the project ready for our repository, using git we are going to push the code to our private repository.
Assuming you already cloned the skeleton repository into your machine, the following is to do your first commit.

Let's execute
```terminal
git add .
git commit -m "Symfony initialization commit"
git push
```

We can have a file with the following content to tell git which directories and files to ignore
```txt:.gitignore
vendor
.DS_Store
.idea
var/cache
```


# Adding a ping endpoint

The following controller is located inside `src > Controller` directory.
```php:PingController.php
<?php

namespace App\Controller;

use Symfony\Component\HttpFoundation\JsonResponse;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\Routing\Annotation\Route;

class PingController
{
    #[Route('/v1/ping')]
    public function Ping(Request $request) : JsonResponse
    {
        return new JsonResponse(['ping' => true]);
    }
}
```

# See the result
You can spin up the instance by running the following
```output
make up
```
and you can access the endpoint on [localhost:8000/v1/ping](http://localhost:8000/v1/ping).

Here you can [see the result I pushed into Github](https://github.com/didslm/keyword-analyser).

# Adding Tests
Next step we are going to add a Unit test checking if we are getting the correct response from this Controller.

First we need to install phpunit
```output
composer require --dev symfony/test-pack
```

Then we are going to add a test unit
```php:PingControllerTest.php
<?php

namespace App\Tests\Application;

use Symfony\Bundle\FrameworkBundle\Test\WebTestCase;


class PingControllerTest extends WebTestCase
{
    public function testShouldSucceed()
    {
        $client = static::createClient();

        // Request a specific page
        $client->request('GET', '/v1/ping');

        $response = $client->getResponse()->getContent();

        // Validate a successful response and some content
        $this->assertResponseIsSuccessful();
        $this->assertEquals(['ping' => true], json_decode($response, true));

    }
}
```
